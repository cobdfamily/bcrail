#!/usr/bin/env bash
set -euo pipefail

BIN_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LIBEXEC_DIR="${BCRAIL_LIBEXEC_DIR:-${BIN_DIR}/../libexec/bcrail}"

if [[ ! -d "${LIBEXEC_DIR}" ]]; then
  echo "Unable to locate bcrail libexec directory: ${LIBEXEC_DIR}" >&2
  exit 2
fi

cmd="${1:-}"
shift || true

if [[ -z "${cmd}" || "${cmd}" == "-h" || "${cmd}" == "--help" ]]; then
  "${LIBEXEC_DIR}/bcrail-help"
  exit 0
fi

subcmd="${LIBEXEC_DIR}/bcrail-${cmd}"
if [[ ! -x "${subcmd}" ]]; then
  echo "Unknown subcommand: ${cmd}" >&2
  echo >&2
  "${LIBEXEC_DIR}/bcrail-help" >&2
  exit 2
fi

"${subcmd}" "$@"
