#!/usr/bin/env bash
set -euo pipefail

context="$(bcrail getcontext)"
host="bcrail-${context}"
key="/var/lib/bcrail/contexts/${context}/keys/${host}"
dns="$(bcrail resolve-incus-dns "${host}")"

# Build a shell-safe remote command preserving argument boundaries.
remote_cmd=(docker "$@")
ssh -i "${key}" "vancouver@${dns}" "$(printf '%q ' "${remote_cmd[@]}")"
